# include-mocha-in-browser

## Цель

Разработать скрипт, позволяющий вызовом одной функции подключать и настраивать тестовое окружение, а также запускать выполнение тестов.

## Постановка задачи

Скрипт должен экспортировать функцию **`includeMocha`** в глобальную область видимости.
Данная функция должна выполнять следующие задачи:
  - загружать, настраивать и запускать модуль 'mocha.js';
  - загружать файлы css-стилей;
  - загружать файлы спецификаций тестов;
  - загружать файлы тестируемых js-скриптов;
  - загружать модуль **`chai.js`** и помещать его в глобальную переменную **`chai`**.

## Детали реализации

### Общие положения

Функция должна корректно работать в браузерах, не поддерживающих атрибут **`async`** тега **`script`**.

Результат вызова **`mocha.run()`** должен быть помещен в свойство **`runner`** объекта-функции **`includeMocha`**.


### Параметры функции

#### `{string} [specRoot="spec/"]`

Путь к директории файлов спецификаций. Относительно данного пути подключаются файлы спецификаций тестов.

#### `{string|string[]} [specPath=[]]`

Путь либо массив путей к файлам спецификаций.

#### `{string|string[]} [scriptPath=[]]`

Путь либо массив путей к файлам тестируемых js-скриптов.

#### `{string} [libRoot="lib/"]`

Путь к директории файлов модулей. Относительно этого пути подключаются все файлы модулей, определенные параметрами **`mochaPath`**, **`chaiPath`** и **`selfPath`**.

#### `{string} [mochaPath="mocha.js"]`

Путь к файлу модуля **`mocha.js`**.

#### `{string} [chaiPath="chai.js"]`

Путь к файлу модуля **`chai.js`**.

#### `{string} [selfPath="include-mocha.js"]`

Путь к файлу данного скрипта. Необходим для работы внутренней реализации.

#### `{string} [cssRoot="css/"]`

Путь к директории css-стилей. Относительно данного пути подключаются файлы css-стилей.

#### `{string|string[]} [cssPath="mocha.css"]`

Путь или массив путей к файлам css-стилей.

#### `{string|Object} [mochaSetup="bdd"]`

Параметры для настройки модуля **`mocha.js`**.

#### `{function(object)} [onComplete=undefined]`

Функция обратной связи

### Передача параметров

В качестве параметра, функция должна принимать объект, массив либо строку.

В случае передачи строки, подразумевается, что передан путь к файлу спецификации тестов.

В случае передачи массива, подразумевается, что передан массив путей к файлам спецификаций тестов.

В случае передачи объекта, подразумевается, что передан ассоциативный массив, ключи которого являются именами параметров функции.

Все параметры, которые не были переданы функции явно, должны принимать значения по умолчанию.

### Обработка ошибок

Все параметры функции, кроме параметра **`mochaSetup`**, должны проходить валидацию. Если функции передан невалидный параметр, необходимо остановить выполнение функции, а так же, через интерфейс обратной связи, сообщить о наличии ошибки и передать объект класса **`Error`**, поле **`message`** которого содержит описание ошибки.

Если невозможно загрузить любой из подключаемых файлов ресурсов (скрипты, стили, спецификации, модули), необходимо остановить выполнение функции, а так же, через интерфейс обратной связи, сообщить о наличии ошибки и передать объект класса **`Error`**, поле **`message`** которого содержит описание ошибки.

Сообщение об ошибке должно быть формата: "Не удалось загрузить внешний ресурс. Адрес ресурса - **`resource-addres`**. Где **`resource-addres`** - содержимое атрибута **`href`** или **`src`** соответствующего ресурсу тега.

### Возвращаемые значения

Функция возвращает **`undefined`**.

### Интерфейс обратной связи

Перед завершением работы работы, функция устанавливает собственное свойство-флаг **`hasError`**. Данное свойство содержит значение **`false`**, если в процессе выполнения функции не были выявлены ошибки, в противном случае свойство содержит **`true`**.

До завершения работы функции, свойство **`hasError`** содержит **`null`**.

По окончание работы, функция вызывает колбэк **`onComplete`**, передавая в качестве единственного параметра информационный объект.

Информационный объект, в любом случае, содержит свойство **`hasError`**. Данное свойство является булевым флагом наличия ошибки выполнения функции.

Если в процессе выполнения функции ошибок не выявлено, свойство **`hasError`** содержит **`false`**, в противном случае - **`true`**.

Если свойство **`hasError`** содержит значение **`true`**, информационный объект так же содержит свойство **`error`**.

Свойство **`error`** содержит объект стандартного класса **`Error`**, сгенерированный в месте обнаружения ошибки, в поле **`message'** которого содержиться описание ошибки.

### Внешние взаимодействия

Определяет глобальные переменные **`mocha`** и **`chai`**, помещая в них одноименные модули.

Добавляет к телу документа элемент **`<div id="mocha"></div>`**, если он не был создан ранее. Данный элемент будет содержать в себе результаты выполнения тестов либо ошибку загрузки ресурсов.